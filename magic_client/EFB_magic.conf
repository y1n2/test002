# ========================================================
# magic.conf
# ARINC 839-2014 MAGIC Diameter 客户端完整配置文件
# 兼容最新 config.h，支持全部19个 Grouped AVP + 历史遗留字段
# 每一行都有详细说明，复制粘贴即可使用
# ========================================================

# --------------------- 基本身份信息 ---------------------
CLIENT_ID           = EFB-01.B-929A.CES             # 设备唯一ID，必须与 freeDiameter Identity 一致
TAIL_NUMBER         = B-929A                        # 飞机注册号，强烈建议填写
AIRCRAFT_TYPE       = C929                          # 机型，用于服务端策略区分

# --------------------- Diameter 路由信息 ---------------------
DESTINATION_REALM   = example.com           # 【必填】地面服务器Realm
# DESTINATION_HOST   = ground1.airchina.com           # 可选，直连时填写服务器FQDN或IP

# --------------------- 会话业务核心参数 ---------------------
PROFILE_NAME         = IP_DATA                       # 【必填】会话类型：IP_DATA / VOICE / VIDEO_STREAM / SAFETY

REQUESTED_BW        = 12000000                     # 请求下行带宽：12Mbps
REQUESTED_RETURN_BW = 3000000                      # 请求上行带宽：3Mbps
REQUIRED_BW         = 4000000                      # 最低保障下行：4Mbps（低于此值认为链路不可用）
REQUIRED_RETURN_BW  = 1000000                      # 最低保障上行：1Mbps

QOS_LEVEL           = 2                             # QoS等级：0=BestEffort 1=Silver 2=Gold 3=Platinum
PRIORITY_CLASS      = 6                             # 协议标准优先级：1~8，数字越大优先级越高

# --------------------- 你特别要求的三个历史字段（已完全支持） ---------------------
MAX_BW              = 20000000                     # 客户端理论最大可申请带宽：20Mbps（用于本地限速判断）
PRIORITY            = 8                             # 旧版优先级字段（1-10），兼容老代码使用
COST_TOLERANCE      = 2.0                          # 费用容忍度：2.0=可以接受最高100%溢价换更好链路

# --------------------- 认证信息（双必填！） ---------------------
USERNAME            = EFB-01                       # 【强制】用户名，地面系统用来识别飞机/设备
CLIENT_PASSWORD     = magic123                     # 【强制】客户端密码，用于认证

SERVER_PASSWORD     = 1111                         # 双向认证密码，与服务器端配置一致

# --------------------- 高级功能开关 ---------------------
TIMEOUT             = 900                          # 会话超时时间（秒），建议600~3600
KEEP_REQUEST        = 1                            # 要求服务器保持会话（长连接）
AUTO_DETECT         = 1                            # 允许自动探测可用链路（推荐开启）

ACCOUNTING_ENABLED   = 1                            # 是否启用计费（1=启用）


# --------------------- 流量过滤规则（TFT） ---------------------
# 格式：_iTFT=[cid,[pf_id,precedence[,src_ip.mask[,dst_ip.mask[,proto[,dst_port[,src_port]]]]]]]
# 地→机（下行）规则，最多32条，按编号填写
TFT_GROUND.1        = _iTFT=,1,10,192.168.126.5.255.255.255.255,10.2.2.8.255.255.255.255,6,80.80,0.65535
TFT_GROUND.2        = _iTFT=,2,20,192.168.126.5.255.255.255.255,10.2.2.8.255.255.255.255,6,443.443,0.65535
TFT_GROUND.3        = _iTFT=,3,30,192.168.126.5.255.255.255.255,10.2.2.8.255.255.255.255,17,5000.5000,0.65535

# 机→地（上行）规则
TFT_AIRCRAFT.1     = _iTFT=,4,10,10.2.2.8.255.255.255.255,192.168.126.5.255.255.255.255,6,0.65535,80.80
# TFT_AIRCRAFT.2   = deny tcp any eq 25 any        # 示例：禁止发邮件

# --------------------- NAPT 端口映射（可选） ---------------------
NAPT.1             = map 192.168.10.50:80 to public:8080
NAPT.2             = map 192.168.10.50:22 to public:2222

# --------------------- 运行与调试参数 ---------------------
LOG_LEVEL           = 3                             # 日志级别：1=Error 2=Warn 3=Info 4=Debug
DUMP_MESSAGES       = 0                             # 是否打印完整Diameter报文（调试用，生产关闭）

AUTO_RECONNECT      = 1                             # 断线自动重连
KEEP_ALIVE_INTERVAL = 30                            # 心跳间隔（秒）

# ========================================================
# 配置文件结束
# 修改后缀无需加分号，空格随意，# 开头为注释
# 修改后建议重启程序确保加载最新配置
# ========================================================